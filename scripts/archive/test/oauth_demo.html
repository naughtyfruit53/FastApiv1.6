<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth Email Integration Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #1976d2;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .content {
            padding: 20px;
        }
        .oauth-section {
            border: 2px solid #e3f2fd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: #f8f9ff;
        }
        .oauth-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .oauth-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .google-btn {
            background: #4285f4;
            color: white;
        }
        .google-btn:hover {
            background: #3367d6;
        }
        .microsoft-btn {
            background: #00a1f1;
            color: white;
        }
        .microsoft-btn:hover {
            background: #0078d4;
        }
        .manual-btn {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        .manual-btn:hover {
            background: #eeeeee;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: white;
        }
        .feature-title {
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 10px;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 5px 0;
            position: relative;
            padding-left: 20px;
        }
        .feature-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
        }
        .security-badge {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .demo-section {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê OAuth2 Email Integration</h1>
            <p>Secure Google & Microsoft Email Integration for TRITIQ BOS</p>
        </div>
        
        <div class="content">
            <div class="demo-section">
                <h3>üéØ Integration Demo</h3>
                <p>This demonstrates the new OAuth2 email integration functionality that has been implemented.</p>
            </div>

            <div class="oauth-section">
                <h3>üìß Email Account Connection</h3>
                <p>Connect your email accounts securely with one click:</p>
                
                <div class="oauth-buttons">
                    <button class="oauth-btn google-btn">
                        <span>üìß</span>
                        Connect Gmail
                        <span class="security-badge">Encrypted</span>
                    </button>
                    <button class="oauth-btn microsoft-btn">
                        <span>üè¢</span>
                        Connect Microsoft
                        <span class="security-badge">Encrypted</span>
                    </button>
                    <button class="oauth-btn manual-btn">
                        <span>‚öôÔ∏è</span>
                        Manual Setup
                    </button>
                </div>
                
                <p><strong>Security Features:</strong></p>
                <ul>
                    <li>üîí All tokens encrypted using field-level encryption</li>
                    <li>üîÑ Automatic token refresh</li>
                    <li>üõ°Ô∏è Limited scope permissions (email only)</li>
                    <li>üìù Comprehensive audit logging</li>
                </ul>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-title">üé® Frontend Features</div>
                    <ul class="feature-list">
                        <li>OAuth2 login buttons</li>
                        <li>Email compose with HTML support</li>
                        <li>Email reader with attachments</li>
                        <li>Token management interface</li>
                        <li>Responsive mail dashboard</li>
                        <li>OAuth callback handling</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <div class="feature-title">‚öôÔ∏è Backend Features</div>
                    <ul class="feature-list">
                        <li>Complete OAuth2 flow</li>
                        <li>Encrypted token storage</li>
                        <li>Gmail API integration</li>
                        <li>Microsoft Graph integration</li>
                        <li>Automatic token refresh</li>
                        <li>Email send/receive APIs</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <div class="feature-title">üîê Security Features</div>
                    <ul class="feature-list">
                        <li>Field-level encryption</li>
                        <li>HTTPS enforcement</li>
                        <li>Limited OAuth scopes</li>
                        <li>PKCE for additional security</li>
                        <li>State parameter validation</li>
                        <li>Comprehensive audit trails</li>
                    </ul>
                </div>
            </div>

            <div class="oauth-section">
                <h3>üìã Database Schema</h3>
                <p>New encrypted tables for secure token storage:</p>
                <div class="code-block">
CREATE TABLE user_email_tokens (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL,
  organization_id INTEGER NOT NULL,
  provider VARCHAR(50) NOT NULL,
  email_address VARCHAR(255) NOT NULL,
  
  -- Encrypted token fields
  access_token_encrypted TEXT NOT NULL,
  refresh_token_encrypted TEXT,
  id_token_encrypted TEXT,
  
  -- Security and metadata
  expires_at TIMESTAMP WITH TIME ZONE,
  status VARCHAR(50) DEFAULT 'active',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
                </div>
            </div>

            <div class="oauth-section">
                <h3>üöÄ API Endpoints</h3>
                <div class="code-block">
# OAuth2 Flow
POST /api/v1/oauth/login/{provider}
POST /api/v1/oauth/callback/{provider}
GET  /api/v1/oauth/tokens
PUT  /api/v1/oauth/tokens/{token_id}

# Email Operations  
GET  /api/v1/email/tokens/{token_id}/emails
GET  /api/v1/email/tokens/{token_id}/emails/{message_id}
POST /api/v1/email/tokens/{token_id}/emails/send
                </div>
            </div>

            <div class="demo-section">
                <h3>‚úÖ Implementation Status</h3>
                <p><strong>Completed:</strong></p>
                <ul>
                    <li>‚úÖ OAuth2 backend endpoints for Google/Microsoft</li>
                    <li>‚úÖ Encrypted user_email_tokens database model</li>
                    <li>‚úÖ Frontend OAuth login components</li>
                    <li>‚úÖ Email compose and reader components</li>
                    <li>‚úÖ Security best practices implementation</li>
                    <li>‚úÖ Documentation and setup guide</li>
                    <li>‚úÖ Basic test coverage</li>
                </ul>
                
                <p><strong>Ready for:</strong></p>
                <ul>
                    <li>üîß Environment configuration</li>
                    <li>üîß OAuth provider setup (Google/Microsoft)</li>
                    <li>üîß Database migration</li>
                    <li>üîß Production deployment</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>