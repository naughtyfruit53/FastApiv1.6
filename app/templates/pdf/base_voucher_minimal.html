<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ voucher.voucher_type|title }} Voucher - {{ voucher.voucher_number }}</title>
    <style>
        /* Page / print - Minimal Clean Style */
        @page { size: A4; margin: 0 }
        html, body { height: 100%; margin: 0; padding: 0; background: #fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 11px; color: #212529 }
        .preview-wrap { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 0; background: #fff; }
        .a4 { width: 210mm; height: 297mm; background: #fff; position: relative; box-sizing: border-box; overflow: hidden; }
        
        /* Voucher title - Minimal style */
        .voucher-title {
            position: absolute;
            top: 0.8cm;
            left: 0;
            right: 0;
            text-align: center;
            font-weight: 300;
            font-size: 24pt;
            line-height: 1;
            z-index: 20;
            color: #0066cc;
            text-transform: uppercase;
            letter-spacing: 4px;
        }
        /* Minimal framed voucher box */
        .voucher-box {
            position: absolute;
            left: 1.5cm;
            top: 2.2cm;
            right: 1.5cm;
            bottom: 1cm;
            border: none;
            box-sizing: border-box;
            padding: 0;
            background: #fff;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }
        /* Clean grid layout */
        .blocks-grid { width: 100%; border-collapse: collapse; table-layout: fixed; margin: 0 0 20px 0; }
        .blocks-grid td {
            border: none;
            border-bottom: 1px solid #e9ecef;
            padding: 0;
            box-sizing: border-box;
            vertical-align: top;
            height: 7em;
            line-height: 1.3em;
            font-size: 11px;
        }
        .block-inner { padding: 14px 16px; font-size: 11px; line-height: 1.3em; }
        #block-1 { width: 50%; border-right: 1px solid #e9ecef; }
        #block-2 { width: 50%; }
        #block-3 { width: 50%; border-right: 1px solid #e9ecef; }
        #block-4 { width: 50%; }
        
        /* Meta table styling - minimal */
        table.meta-table { width: 100%; border-collapse: collapse; }
        table.meta-table tr { border: none; }
        table.meta-table td { padding: 6px 0; vertical-align: top; }
        table.meta-table td.label { font-weight: 400; color: #6c757d; width: 45%; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        table.meta-table td.value { text-align: right; color: #212529; font-weight: 600; }
        
        /* Items table - minimal clean design */
        table.items-table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        table.items-table thead { background: #f8f9fa; border-top: 2px solid #0066cc; border-bottom: 2px solid #0066cc; }
        table.items-table th { padding: 12px 8px; font-size: 10px; font-weight: 600; text-align: left; text-transform: uppercase; letter-spacing: 0.5px; color: #495057; border: none; }
        table.items-table td { padding: 10px 8px; border-bottom: 1px solid #e9ecef; font-size: 11px; color: #212529; }
        table.items-table tbody tr:hover { background: #f8f9fa; }
        table.items-table .num { text-align: right; }
        table.items-table .text-center { text-align: center; color: #6c757d; font-style: italic; }
        table.items-table tfoot { font-weight: 600; background: #f8f9fa; border-top: 2px solid #0066cc; }
        table.items-table tfoot td { border: none; padding: 10px 8px; }
        
        /* Totals section - minimal card style */
        table.totals-bank { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table.totals-bank td.left-side { width: 48%; vertical-align: top; padding: 16px; background: #f8f9fa; border-radius: 4px; }
        table.totals-bank td.totals { width: 50%; vertical-align: top; padding-left: 20px; }
        table.totals-bank td.totals table { width: 100%; border-collapse: collapse; }
        table.totals-bank td.totals table td { padding: 8px 0; border: none; }
        table.totals-bank td.totals table tr { border-bottom: 1px solid #e9ecef; }
        table.totals-bank td.totals table tr:last-child { border-top: 2px solid #0066cc; border-bottom: none; padding-top: 12px; }
        table.totals-bank td.totals table td.muted { color: #6c757d; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        table.totals-bank td.totals table td.right { text-align: right; font-weight: 600; color: #212529; }
        table.totals-bank td.totals table tr:last-child td { padding-top: 12px; }
        table.totals-bank td.totals table tr:last-child td.muted { font-size: 11px; font-weight: 600; color: #212529; }
        table.totals-bank td.totals table tr:last-child td.right { color: #0066cc; font-size: 14px; font-weight: 700; }
        
        /* Amount in words - minimal box */
        .amount-words { margin: 20px 0; padding: 16px; background: #f8f9fa; border-left: 3px solid #0066cc; }
        .amount-words .label { font-weight: 400; color: #6c757d; margin-bottom: 6px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .amount-words .words { font-weight: 600; color: #212529; font-size: 12px; }
        
        /* Terms & Conditions - minimal style */
        .terms { margin: 20px 0; padding: 16px; background: #fff; border-left: 3px solid #28a745; }
        .terms .terms-title { font-weight: 600; color: #28a745; margin-bottom: 10px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .terms table { width: 100%; border-collapse: collapse; }
        .terms table td { padding: 5px 0; font-size: 10.5px; color: #495057; line-height: 1.5; }
        
        /* Signatures - minimal footer */
        .signatures { margin-top: auto; padding: 24px 0 0 0; border-top: 1px solid #e9ecef; display: flex; justify-content: flex-end; align-items: center; }
        .signatures > div { text-align: center; }
        
        /* Utility classes */
        .num { text-align: right; }
        .col-sr { width: 5%; text-align: center; }
        .col-product { width: 30%; }
        .col-hsn { width: 10%; }
        .col-qty { width: 12%; }
        .col-rate { width: 12%; }
        .col-disc { width: 8%; }
        .col-gst { width: 8%; }
        .col-line { width: 15%; }
        
        /* Section headers */
        .section-header { font-weight: 600; color: #0066cc; margin-bottom: 8px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
    </style>
</head>
<body>
    <div class="preview-wrap">
        <div class="a4">
            <!-- Voucher Title -->
            <div class="voucher-title">
                {% block voucher_title %}{{ voucher_type_title|upper }}{% endblock %}
            </div>
            <!-- Voucher Box -->
            <div class="voucher-box">
                <!-- 2x2 grid at top -->
                <table class="blocks-grid" role="presentation">
                    <tbody>
                        <tr>
                            <!-- TOP LEFT: Company info with logo -->
                            <td id="block-1">
                                <div class="block-inner">
                                    {% if company.logo_url %}
                                    <div style="margin-bottom:12px;">
                                        <img src="{{ company.logo_url }}" alt="Company Logo" style="max-width:130px; max-height:55px;" />
                                    </div>
                                    {% endif %}
                                    <div style="font-weight:600; font-size:13px; color:#212529; margin-bottom:8px;">{{ company.name }}</div>
                                    <div style="line-height:1.5; color:#6c757d; font-size:10.5px;">
                                        {{ company.address }}<br>
                                        {% if company.city %}{{ company.city }}{% if company.state %}, {{ company.state }}{% endif %}{% if company.pin_code %} {{ company.pin_code }}{% endif %}<br>{% endif %}
                                        {% if company.phone %}{{ company.phone }}{% if company.email %} â€¢ {% endif %}{% endif %}
                                        {% if company.email %}{{ company.email }}<br>{% endif %}
                                        {% if company.gst_number %}<span style="font-weight:600; color:#212529;">GSTIN:</span> {{ company.gst_number }}{% endif %}
                                    </div>
                                </div>
                            </td>
                            <!-- TOP RIGHT: meta table -->
                            <td id="block-2">
                                <div class="block-inner">
                                    <table class="meta-table" role="table">
                                        <tbody>
                                            {% block voucher_meta %}
                                            <tr><td class="label">Date</td><td class="value">{{ voucher.date|format_date(format_str=org.date_format or '%d/%m/%Y') }}</td></tr>
                                            <tr><td class="label">Voucher Number</td><td class="value">{{ voucher.voucher_number|default('N/A') }}</td></tr>
                                            {% if voucher.reference_number %}<tr><td class="label">Reference</td><td class="value">{{ voucher.reference_number }}</td></tr>{% endif %}
                                            {% endblock %}
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <!-- BOTTOM LEFT: Bill To -->
                            <td id="block-3">
                                <div class="block-inner">
                                    {% set party = voucher.vendor or voucher.customer %}
                                    {% if party %}
                                    <div class="section-header">{{ 'Bill From' if voucher.vendor else 'Bill To' }}</div>
                                    <div style="font-weight:600; margin-bottom:6px; color:#212529;">{{ party.name }}</div>
                                    <div style="line-height:1.5; color:#6c757d; font-size:10.5px;">
                                        {{ party.address }}{% if party.city %}, {{ party.city }}{% endif %}{% if party.state %}, {{ party.state }}{% endif %}{% if party.pin_code %} {{ party.pin_code }}{% endif %}<br>
                                        {% if party.contact_number %}{{ party.contact_number }}<br>{% endif %}
                                        {% if party.gst_number %}<span style="font-weight:600; color:#212529;">GSTIN:</span> {{ party.gst_number }}{% endif %}
                                    </div>
                                    {% else %}
                                    <div class="section-header">No Party Details</div>
                                    {% endif %}
                                </div>
                            </td>
                            <!-- BOTTOM RIGHT: Ship To -->
                            <td id="block-4">
                                <div class="block-inner">
                                    <div class="section-header">Ship To</div>
                                    {% if voucher.shipping_address %}
                                    <div style="font-weight:600; margin-bottom:6px; color:#212529;">{{ voucher.shipping_address.name|default('') }}</div>
                                    <div style="line-height:1.5; color:#6c757d; font-size:10.5px;">{{ voucher.shipping_address.address }}</div>
                                    {% else %}
                                    {% if party %}
                                    <div style="font-weight:600; margin-bottom:6px; color:#212529;">{{ party.name }}</div>
                                    <div style="line-height:1.5; color:#6c757d; font-size:10.5px; font-style:italic;">Same as billing address</div>
                                    {% endif %}
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                {% block after_blocks_grid %}{% endblock %}
                
                <!-- Items table -->
                <table class="items-table" role="table">
                    <thead>
                        <tr>
                            <th class="col-sr">#</th>
                            <th class="col-product">Description</th>
                            <th class="col-hsn">HSN</th>
                            <th class="col-qty">Qty</th>
                            <th class="col-rate">Rate</th>
                            {% if line_discount_enabled %}<th class="col-disc">Disc</th>{% endif %}
                            <th class="col-gst">Tax</th>
                            <th class="col-line">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if items|length > 0 %}
                        {% for item in items %}
                        <tr>
                            <td class="col-sr">{{ loop.index }}</td>
                            <td class="col-product">{{ item.product_name|default(item.description, 'Product') }}</td>
                            <td class="col-hsn">{{ item.hsn_code|default('â€”') }}</td>
                            <td class="col-qty num">{% if item.quantity > 0 %}{{ "%.2f"|format(item.quantity|float) }} {{ item.unit|default('Nos') }}{% else %}â€”{% endif %}</td>
                            <td class="col-rate num">{{ item.unit_price|format_currency(show_symbol=True) }}</td>
                            {% if line_discount_enabled %}
                            <td class="col-disc num">
                                {% if item.discount_percentage > 0 %}{{ item.discount_percentage }}%{% elif item.discount_amount > 0 %}{{ item.discount_amount|format_currency(show_symbol=True) }}{% else %}â€”{% endif %}
                            </td>
                            {% endif %}
                            <td class="col-gst num">{{ item.gst_rate|format_percentage }}%</td>
                            <td class="col-line num">{{ item.total_amount|format_currency(show_symbol=True) }}</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="{% if line_discount_enabled %}8{% else %}7{% endif %}" class="text-center">No items</td>
                        </tr>
                        {% endif %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td></td>
                            <td style="text-align:right;">Subtotal</td>
                            <td></td>
                            <td class="num">{{ total_quantity|default(0) }}</td>
                            <td></td>
                            {% if line_discount_enabled %}<td></td>{% endif %}
                            <td></td>
                            <td class="num">{{ subtotal|format_currency(show_symbol=True) }}</td>
                        </tr>
                    </tfoot>
                </table>
                
                <!-- Bank Details & Totals -->
                <table class="totals-bank" role="region">
                    <tr>
                        <td class="left-side">
                            {% block totals_left %}
                            <div class="section-header" style="color:#212529;">Bank Details</div>
                            {% if company.bank_details %}
                            <div style="line-height:1.6; font-size:10.5px; color:#495057;">
                                <div><strong style="color:#212529;">Account:</strong> {{ company.bank_details.holder_name|default(company.name) }}</div>
                                <div><strong style="color:#212529;">Number:</strong> {{ company.bank_details.account_number }}</div>
                                <div><strong style="color:#212529;">IFSC:</strong> {{ company.bank_details.ifsc }}</div>
                                <div><strong style="color:#212529;">Bank:</strong> {{ company.bank_details.bank_name }}</div>
                                <div><strong style="color:#212529;">Branch:</strong> {{ company.bank_details.branch }}</div>
                            </div>
                            {% endif %}
                            {% if company.pan_number %}<div style="margin-top:10px; font-size:10px; color:#6c757d;"><strong style="color:#212529;">PAN:</strong> {{ company.pan_number }}</div>{% endif %}
                            {% endblock %}
                        </td>
                        <td class="totals">
                            <table>
                                <tbody>
                                    <tr><td class="muted">Taxable Amount</td><td class="right num">{{ total_taxable|format_currency(show_symbol=True) }}</td></tr>
                                    {% if is_interstate %}
                                    <tr><td class="muted">IGST @ {{ voucher.gst_rate|default(18) }}%</td><td class="right num">{{ total_igst|format_currency(show_symbol=True) }}</td></tr>
                                    {% else %}
                                    <tr><td class="muted">CGST @ {{ voucher.gst_rate|default(9) }}%</td><td class="right num">{{ total_cgst|format_currency(show_symbol=True) }}</td></tr>
                                    <tr><td class="muted">SGST @ {{ voucher.gst_rate|default(9) }}%</td><td class="right num">{{ total_sgst|format_currency(show_symbol=True) }}</td></tr>
                                    {% endif %}
                                    <tr><td class="muted">Round Off</td><td class="right num">{{ round_off|format_currency(show_symbol=True) }}</td></tr>
                                    <tr><td class="muted">Total</td><td class="right num">{{ grand_total|format_currency(show_symbol=True) }}</td></tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                </table>
                
                <!-- Amount in words -->
                {% block amount_words_block %}
                <div class="amount-words">
                    <div class="label">Amount in Words</div>
                    <div class="words">{{ amount_in_words }}</div>
                </div>
                {% endblock %}
                
                <!-- Terms & Conditions -->
                {% block terms_block %}
                {% if terms_conditions %}
                <div class="terms">
                    <div class="terms-title">Terms & Conditions</div>
                    <table>
                        <tbody>
                            {% for term in terms_conditions.split('\n') %}
                            {% if term|trim %}
                            <tr><td>{{ loop.index }}. {{ term|trim }}</td></tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
                {% endblock %}
                
                <!-- Signatures -->
                {% block signatures_block %}
                <div class="signatures">
                    <div style="text-align:right;">
                        <div style="font-weight:400; color:#6c757d; margin-bottom:8px; font-size:10px; text-transform:uppercase; letter-spacing:0.5px;">For {{ company.name }}</div>
                        <div style="height:40px;"></div>
                        <div style="border-top:1px solid #212529; padding-top:6px; font-weight:600; color:#212529; min-width:180px; display:inline-block;">Authorized Signatory</div>
                    </div>
                </div>
                {% endblock %}
                
                {% block voucher_specific_footer %}{% endblock %}
            </div>
        </div>
    </div>
</body>
</html>
