<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ voucher.voucher_type|title }} Voucher - {{ voucher.voucher_number }}</title>
    <style>
        /* Page / print - Modern Style */
        @page { size: A4; margin: 0 }
        html, body { height: 100%; margin: 0; padding: 0; background: #f8f9fa; font-family: "Segoe UI", Roboto, Arial, sans-serif; font-size: 11px; color: #2c3e50 }
        .preview-wrap { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 0; background: #f8f9fa; }
        .a4 { width: 210mm; height: 297mm; background: #fff; position: relative; box-sizing: border-box; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        /* Voucher title - Modern gradient */
        .voucher-title {
            position: absolute;
            top: 0.5cm;
            left: 0;
            right: 0;
            text-align: center;
            font-weight: 700;
            font-size: 20pt;
            line-height: 1;
            z-index: 20;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        /* Modern framed voucher box with shadow */
        .voucher-box {
            position: absolute;
            left: 1.25cm;
            top: 1.5cm;
            right: 0.75cm;
            bottom: 0.5cm;
            border: 2px solid #667eea;
            border-radius: 8px;
            box-sizing: border-box;
            padding: 0;
            background: #fff;
            overflow: auto;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.1);
        }
        /* 2x2 grid with modern borders */
        .blocks-grid { width: 100%; border-collapse: collapse; table-layout: fixed; margin: 0 }
        .blocks-grid td {
            border: 1px solid #e1e8ed;
            padding: 0;
            box-sizing: border-box;
            vertical-align: top;
            height: 6.9em;
            line-height: 1.15em;
            font-size: 11px;
        }
        .block-inner { padding: 10px 12px; font-size: 11px; line-height: 1.15em; }
        #block-1 { width: 50%; border-top: 2px solid #667eea; }
        #block-2 { width: 50%; border-top: 2px solid #667eea; }
        #block-3 { width: 50%; border-bottom: 2px solid #667eea; }
        #block-4 { width: 50%; border-bottom: 2px solid #667eea; }
        
        /* Meta table styling */
        table.meta-table { width: 100%; border-collapse: collapse; }
        table.meta-table tr { border-bottom: 1px solid #e1e8ed; }
        table.meta-table tr:last-child { border-bottom: none; }
        table.meta-table td { padding: 4px 0; vertical-align: top; }
        table.meta-table td.label { font-weight: 600; color: #667eea; width: 45%; }
        table.meta-table td.value { text-align: right; color: #2c3e50; }
        
        /* Items table - modern design */
        table.items-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table.items-table thead { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
        table.items-table th { padding: 10px 6px; font-size: 10.5px; font-weight: 600; text-align: left; border: 1px solid #fff; }
        table.items-table td { padding: 8px 6px; border: 1px solid #e1e8ed; font-size: 10.5px; }
        table.items-table tbody tr:hover { background: #f8f9fa; }
        table.items-table .num { text-align: right; }
        table.items-table .text-center { text-align: center; }
        table.items-table tfoot { font-weight: 600; background: #f8f9fa; }
        
        /* Totals section - modern card style */
        table.totals-bank { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table.totals-bank td.left-side { width: 50%; vertical-align: top; padding: 12px; background: #f8f9fa; border-radius: 6px; }
        table.totals-bank td.totals { width: 50%; vertical-align: top; padding-left: 10px; }
        table.totals-bank td.totals table { width: 100%; border-collapse: collapse; }
        table.totals-bank td.totals table td { padding: 6px 8px; border-bottom: 1px solid #e1e8ed; }
        table.totals-bank td.totals table td.muted { color: #718096; }
        table.totals-bank td.totals table td.right { text-align: right; font-weight: 600; color: #2c3e50; }
        
        /* Amount in words - modern box */
        .amount-words { margin: 10px 0; padding: 12px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 6px; border-left: 4px solid #667eea; }
        .amount-words .label { font-weight: 600; color: #667eea; margin-bottom: 4px; }
        .amount-words .words { font-weight: 700; color: #2c3e50; font-size: 12px; }
        
        /* Terms & Conditions - modern style */
        .terms { margin: 10px 0; padding: 12px; background: #fef9e7; border-radius: 6px; border-left: 4px solid #f39c12; }
        .terms table { width: 100%; border-collapse: collapse; }
        .terms table td { padding: 4px 0; font-size: 10px; color: #5d4037; }
        
        /* Signatures - modern footer */
        .signatures { margin-top: auto; padding: 16px; border-top: 2px solid #667eea; display: flex; justify-content: space-between; align-items: center; }
        .signatures > div { text-align: center; }
        
        /* Utility classes */
        .num { text-align: right; font-family: 'Courier New', monospace; }
        .col-sr { width: 5%; text-align: center; }
        .col-product { width: 30%; }
        .col-hsn { width: 10%; }
        .col-qty { width: 12%; }
        .col-rate { width: 12%; }
        .col-disc { width: 8%; }
        .col-gst { width: 8%; }
        .col-line { width: 15%; }
    </style>
</head>
<body>
    <div class="preview-wrap">
        <div class="a4">
            <!-- Voucher Title -->
            <div class="voucher-title">
                {% block voucher_title %}{{ voucher_type_title|upper }}{% endblock %}
            </div>
            <!-- Voucher Box -->
            <div class="voucher-box">
                <!-- 2x2 grid at top -->
                <table class="blocks-grid" role="presentation">
                    <tbody>
                        <tr>
                            <!-- TOP LEFT: Company info with logo -->
                            <td id="block-1">
                                <div class="block-inner">
                                    {% if company.logo_url %}
                                    <div style="margin-bottom:8px;">
                                        <img src="{{ company.logo_url }}" alt="Company Logo" style="max-width:120px; max-height:50px;" />
                                    </div>
                                    {% endif %}
                                    <div style="font-weight:700; font-size:13px; color:#667eea;">{{ company.name|upper }}</div>
                                    <div style="margin-top:4px; line-height:1.3;">
                                        {{ company.address }}<br>
                                        {% if company.city %}{{ company.city }}{% if company.state %}, {{ company.state }}{% endif %}{% if company.pin_code %} - {{ company.pin_code }}{% endif %}<br>{% endif %}
                                        {% if company.phone %}Phone: {{ company.phone }}<br>{% endif %}
                                        {% if company.email %}Email: {{ company.email }}<br>{% endif %}
                                        {% if company.gst_number %}<strong>GSTIN:</strong> {{ company.gst_number }}<br>{% endif %}
                                    </div>
                                </div>
                            </td>
                            <!-- TOP RIGHT: meta table -->
                            <td id="block-2">
                                <div class="block-inner">
                                    <table class="meta-table" role="table">
                                        <tbody>
                                            {% block voucher_meta %}
                                            <tr><td class="label">Date</td><td class="value">{{ voucher.date|format_date(format_str=org.date_format or '%d/%m/%Y') }}</td></tr>
                                            <tr><td class="label">Voucher No.</td><td class="value">{{ voucher.voucher_number|default('N/A') }}</td></tr>
                                            {% if voucher.reference_number %}<tr><td class="label">Ref No.</td><td class="value">{{ voucher.reference_number }}</td></tr>{% endif %}
                                            {% endblock %}
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <!-- BOTTOM LEFT: Bill To -->
                            <td id="block-3">
                                <div class="block-inner">
                                    {% set party = voucher.vendor or voucher.customer %}
                                    {% if party %}
                                    <div style="font-weight:700; color:#667eea;">{{ 'Vendor' if voucher.vendor else 'Customer' }} Details</div>
                                    <div style="font-weight:600; margin-top:4px;">{{ party.name|upper }}</div>
                                    <div style="line-height:1.3;">{{ party.address }}{% if party.city %}, {{ party.city }}{% endif %}{% if party.state %}, {{ party.state }}{% endif %}{% if party.pin_code %} - {{ party.pin_code }}{% endif %}</div>
                                    {% if party.contact_number %}<div>Contact: {{ party.contact_number }}</div>{% endif %}
                                    {% if party.gst_number %}<div>GSTIN: {{ party.gst_number }}</div>{% endif %}
                                    {% else %}
                                    <div style="font-weight:700;">No Party Details</div>
                                    {% endif %}
                                </div>
                            </td>
                            <!-- BOTTOM RIGHT: Ship To -->
                            <td id="block-4">
                                <div class="block-inner">
                                    <div style="font-weight:700; color:#667eea;">Ship To</div>
                                    {% if voucher.vendor %}
                                    <!-- For purchase vouchers, show company address as ship to -->
                                    <div style="font-weight:600;">{{ company.name|upper }}</div>
                                    <div>{{ company.address1 }}{% if company.address2 %}, {{ company.address2 }}{% endif %}</div>
                                    <div>{{ company.city }}{% if company.state %}, {{ company.state }}{% endif %}{% if company.pin_code %} - {{ company.pin_code }}{% endif %}</div>
                                    {% if company.contact_number %}<div>Contact: {{ company.contact_number }}</div>{% endif %}
                                    {% if company.gst_number %}<div>GSTIN: {{ company.gst_number }}</div>{% endif %}
                                    {% else %}
                                    <!-- For sales vouchers, show shipping address or customer -->
                                    {% if voucher.shipping_address %}
                                    <div style="font-weight:600;">{{ voucher.shipping_address.name|default('') }}</div>
                                    <div>{{ voucher.shipping_address.address }}</div>
                                    <div>{{ voucher.shipping_address.city }}{% if voucher.shipping_address.state %}, {{ voucher.shipping_address.state }}{% endif %}{% if voucher.shipping_address.pin_code %} - {{ voucher.shipping_address.pin_code }}{% endif %}</div>
                                    {% if voucher.shipping_address.contact %}<div>Contact: {{ voucher.shipping_address.contact }}</div>{% endif %}
                                    {% if voucher.shipping_address.email %}<div>Email: {{ voucher.shipping_address.email }}</div>{% endif %}
                                    {% if voucher.shipping_address.gst_number %}<div>GSTIN: {{ voucher.shipping_address.gst_number }}</div>{% endif %}
                                    {% if voucher.shipping_address.pan_number %}<div>PAN: {{ voucher.shipping_address.pan_number }}</div>{% endif %}
                                    {% else %}
                                    {% if party %}
                                    <div style="font-weight:600;">{{ party.name|upper }}</div>
                                    <div>{{ party.address }}{% if party.city %}, {{ party.city }}{% endif %}{% if party.state %}, {{ party.state }}{% endif %}{% if party.pin_code %} - {{ party.pin_code }}{% endif %}</div>
                                    {% if party.contact_number %}<div>Contact: {{ party.contact_number }}</div>{% endif %}
                                    {% if party.email %}<div>Email: {{ party.email }}</div>{% endif %}
                                    {% if party.gst_number %}<div>GSTIN: {{ party.gst_number }}</div>{% endif %}
                                    {% if party.pan_number %}<div>PAN: {{ party.pan_number }}</div>{% endif %}
                                    {% else %}
                                    <div style="font-weight:600;">(Same as Bill To)</div>
                                    {% endif %}
                                    {% endif %}
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                {% block after_blocks_grid %}{% endblock %}
                
                <!-- Items table -->
                <table class="items-table" role="table">
                    <thead>
                        <tr>
                            <th class="col-sr">Sr No.</th>
                            <th class="col-product">Product Name</th>
                            <th class="col-hsn">HSN</th>
                            <th class="col-qty">Quantity</th>
                            <th class="col-rate">Rate</th>
                            {% if line_discount_enabled %}<th class="col-disc">Disc</th>{% endif %}
                            <th class="col-gst">GST%</th>
                            <th class="col-line">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if items|length > 0 %}
                        {% for item in items %}
                        <tr>
                            <td class="col-sr">{{ loop.index }}</td>
                            <td class="col-product">{{ item.product_name|default(item.description, 'Product') }}</td>
                            <td class="col-hsn">{{ item.hsn_code|default('-') }}</td>
                            <td class="col-qty num">{% if item.quantity > 0 %}{{ "%.2f"|format(item.quantity|float) }} {{ item.unit|default('Nos') }}{% else %}-{% endif %}</td>
                            <td class="col-rate num">{{ item.unit_price|format_currency(show_symbol=True) }}</td>
                            {% if line_discount_enabled %}
                            <td class="col-disc num">
                                {% if item.discount_percentage > 0 %}{{ item.discount_percentage }}%{% elif item.discount_amount > 0 %}{{ item.discount_amount|format_currency(show_symbol=True) }}{% else %}-{% endif %}
                            </td>
                            {% endif %}
                            <td class="col-gst num">{{ item.gst_rate|format_percentage }}%</td>
                            <td class="col-line num">{{ item.total_amount|format_currency(show_symbol=True) }}</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="{% if line_discount_enabled %}8{% else %}7{% endif %}" class="text-center">No items available</td>
                        </tr>
                        {% endif %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td></td>
                            <td style="font-weight:600;">Totals</td>
                            <td></td>
                            <td class="num">{{ total_quantity|default(0) }}</td>
                            <td></td>
                            {% if line_discount_enabled %}<td></td>{% endif %}
                            <td></td>
                            <td class="num">{{ subtotal|format_currency(show_symbol=True) }}</td>
                        </tr>
                    </tfoot>
                </table>
                
                <!-- Bank Details & Totals -->
                <table class="totals-bank" role="region">
                    <tr>
                        <td class="left-side">
                            {% block totals_left %}
                            <div style="font-weight:700; color:#667eea; margin-bottom:6px;">Company's Bank Details</div>
                            {% if company.bank_details %}
                            <div style="line-height:1.4;">
                                <div><strong>A/c Holder:</strong> {{ company.bank_details.holder_name|default(company.name) }}</div>
                                <div><strong>A/c No.:</strong> {{ company.bank_details.account_number }}</div>
                                <div><strong>IFSC:</strong> {{ company.bank_details.ifsc }}</div>
                                <div><strong>Bank:</strong> {{ company.bank_details.bank_name }} ({{ company.bank_details.branch }})</div>
                            </div>
                            {% endif %}
                            {% if company.pan_number %}<div style="margin-top:6px; font-size:10px; color:#718096;">PAN: {{ company.pan_number }}</div>{% endif %}
                            {% endblock %}
                        </td>
                        <td class="totals">
                            <table>
                                <tbody>
                                    <tr><td class="muted">Taxable Value</td><td class="right num">{{ total_taxable|format_currency(show_symbol=True) }}</td></tr>
                                    {% if is_interstate %}
                                    <tr><td class="muted">IGST @ {{ voucher.gst_rate|default(18) }}%</td><td class="right num">{{ total_igst|format_currency(show_symbol=True) }}</td></tr>
                                    {% else %}
                                    <tr><td class="muted">CGST @ {{ voucher.gst_rate|default(9) }}%</td><td class="right num">{{ total_cgst|format_currency(show_symbol=True) }}</td></tr>
                                    <tr><td class="muted">SGST @ {{ voucher.gst_rate|default(9) }}%</td><td class="right num">{{ total_sgst|format_currency(show_symbol=True) }}</td></tr>
                                    {% endif %}
                                    <tr><td class="muted">Round Off</td><td class="right num">{{ round_off|format_currency(show_symbol=True) }}</td></tr>
                                    <tr style="border-top:2px solid #667eea;"><td style="font-weight:700; color:#2c3e50;">Total</td><td class="right num" style="font-weight:700; color:#667eea; font-size:13px;">{{ grand_total|format_currency(show_symbol=True) }}</td></tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                </table>
                
                <!-- Amount in words -->
                {% block amount_words_block %}
                <div class="amount-words">
                    <div class="label">Total (In Words):</div>
                    <div class="words">{{ amount_in_words }}</div>
                </div>
                {% endblock %}
                
                <!-- Terms & Conditions -->
                {% block terms_block %}
                {% if terms_conditions %}
                <div class="terms">
                    <div style="font-weight:700; color:#d68910; margin-bottom:6px;">Terms & Conditions</div>
                    <table>
                        <tbody>
                            {% for term in terms_conditions.split('\n') %}
                            {% if term|trim %}
                            <tr><td>{{ loop.index }}. {{ term|trim }}</td></tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
                {% endblock %}
                
                <!-- Signatures -->
                {% block signatures_block %}
                <div class="signatures">
                    <div style="width:50%;"></div>
                    <div style="width:50%; text-align:right;">
                        <div style="font-weight:600; color:#667eea;">For {{ company.name|upper }}</div>
                        <div style="height:30px;"></div>
                        <div style="border-top:2px solid #2c3e50; display:inline-block; padding-top:4px; min-width:200px;">Authorized Signature</div>
                    </div>
                </div>
                {% endblock %}
                
                {% block voucher_specific_footer %}{% endblock %}
            </div>
        </div>
    </div>
</body>
</html>