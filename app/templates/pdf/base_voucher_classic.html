<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ voucher.voucher_type|title }} Voucher - {{ voucher.voucher_number }}</title>
    <style>
        /* Page / print - Classic Professional Style */
        @page { size: A4; margin: 0 }
        html, body { height: 100%; margin: 0; padding: 0; background: #fff; font-family: "Georgia", "Times New Roman", serif; font-size: 11px; color: #000 }
        .preview-wrap { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 0; background: #fff; }
        .a4 { width: 210mm; height: 297mm; background: #fff; position: relative; box-sizing: border-box; overflow: hidden; }
        
        /* Voucher title - Classic style */
        .voucher-title {
            position: absolute;
            top: 0.5cm;
            left: 0;
            right: 0;
            text-align: center;
            font-weight: 700;
            font-size: 22pt;
            line-height: 1;
            z-index: 20;
            color: #1a1a1a;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 3px double #1a1a1a;
            padding-bottom: 5px;
            margin: 0 1.25cm;
        }
        /* Classic framed voucher box */
        .voucher-box {
            position: absolute;
            left: 1.25cm;
            top: 2cm;
            right: 0.75cm;
            bottom: 0.5cm;
            border: 3px double #1a1a1a;
            box-sizing: border-box;
            padding: 0;
            background: #fff;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }
        /* 2x2 grid with classic double borders */
        .blocks-grid { width: 100%; border-collapse: collapse; table-layout: fixed; margin: 0 }
        .blocks-grid td {
            border: 2px solid #1a1a1a;
            padding: 0;
            box-sizing: border-box;
            vertical-align: top;
            height: 7em;
            line-height: 1.2em;
            font-size: 11px;
        }
        .block-inner { padding: 12px 14px; font-size: 11px; line-height: 1.2em; }
        #block-1, #block-2, #block-3, #block-4 { width: 50%; }
        
        /* Meta table styling - classic */
        table.meta-table { width: 100%; border-collapse: collapse; }
        table.meta-table tr { border-bottom: 1px solid #666; }
        table.meta-table tr:last-child { border-bottom: none; }
        table.meta-table td { padding: 5px 0; vertical-align: top; }
        table.meta-table td.label { font-weight: 700; color: #000; width: 50%; }
        table.meta-table td.value { text-align: right; color: #1a1a1a; font-weight: 600; }
        
        /* Items table - classic design with heavy borders */
        table.items-table { width: 100%; border-collapse: collapse; margin-top: 12px; border: 2px solid #1a1a1a; }
        table.items-table thead { background: #1a1a1a; color: #fff; }
        table.items-table th { padding: 10px 6px; font-size: 11px; font-weight: 700; text-align: left; border: 2px solid #1a1a1a; text-transform: uppercase; }
        table.items-table td { padding: 8px 6px; border: 1px solid #666; font-size: 11px; }
        table.items-table .num { text-align: right; font-family: 'Courier New', monospace; }
        table.items-table .text-center { text-align: center; }
        table.items-table tfoot { font-weight: 700; background: #e8e8e8; border-top: 3px solid #1a1a1a; }
        
        /* Totals section - classic table style */
        table.totals-bank { width: 100%; border-collapse: collapse; margin-top: 12px; border: 2px solid #1a1a1a; }
        table.totals-bank td.left-side { width: 50%; vertical-align: top; padding: 14px; border-right: 2px solid #1a1a1a; background: #f5f5f5; }
        table.totals-bank td.totals { width: 50%; vertical-align: top; padding: 14px; }
        table.totals-bank td.totals table { width: 100%; border-collapse: collapse; }
        table.totals-bank td.totals table td { padding: 7px 10px; border-bottom: 1px solid #ccc; }
        table.totals-bank td.totals table td.muted { color: #444; font-weight: 600; }
        table.totals-bank td.totals table td.right { text-align: right; font-weight: 700; color: #000; }
        table.totals-bank td.totals table tr:last-child td { border-bottom: 3px double #1a1a1a; }
        
        /* Amount in words - classic box with heavy border */
        .amount-words { margin: 12px 0; padding: 14px; background: #f9f9f9; border: 2px solid #1a1a1a; }
        .amount-words .label { font-weight: 700; color: #000; margin-bottom: 6px; text-transform: uppercase; }
        .amount-words .words { font-weight: 700; color: #1a1a1a; font-size: 12px; font-style: italic; }
        
        /* Terms & Conditions - classic bordered box */
        .terms { margin: 12px 0; padding: 14px; background: #fafafa; border: 2px solid #1a1a1a; }
        .terms .terms-title { font-weight: 700; color: #000; margin-bottom: 8px; text-transform: uppercase; border-bottom: 2px solid #1a1a1a; padding-bottom: 4px; }
        .terms table { width: 100%; border-collapse: collapse; }
        .terms table td { padding: 5px 0; font-size: 10.5px; color: #1a1a1a; line-height: 1.4; }
        
        /* Signatures - classic footer with heavy border */
        .signatures { margin-top: auto; padding: 18px; border: 2px solid #1a1a1a; border-top: 3px double #1a1a1a; display: flex; justify-content: space-between; align-items: flex-end; background: #f5f5f5; }
        .signatures > div { text-align: center; min-width: 200px; }
        .signatures .sig-line { border-top: 2px solid #1a1a1a; margin-top: 40px; padding-top: 6px; font-weight: 700; }
        
        /* Utility classes */
        .num { text-align: right; font-family: 'Courier New', monospace; }
        .col-sr { width: 5%; text-align: center; }
        .col-product { width: 30%; }
        .col-hsn { width: 10%; }
        .col-qty { width: 12%; }
        .col-rate { width: 12%; }
        .col-disc { width: 8%; }
        .col-gst { width: 8%; }
        .col-line { width: 15%; }
    </style>
</head>
<body>
    <div class="preview-wrap">
        <div class="a4">
            <!-- Voucher Title -->
            <div class="voucher-title">
                {% block voucher_title %}{{ voucher_type_title|upper }}{% endblock %}
            </div>
            <!-- Voucher Box -->
            <div class="voucher-box">
                <!-- 2x2 grid at top -->
                <table class="blocks-grid" role="presentation">
                    <tbody>
                        <tr>
                            <!-- TOP LEFT: Company info with logo -->
                            <td id="block-1">
                                <div class="block-inner">
                                    {% if company.logo_url %}
                                    <div style="margin-bottom:10px; text-align:center;">
                                        <img src="{{ company.logo_url }}" alt="Company Logo" style="max-width:140px; max-height:60px;" />
                                    </div>
                                    {% endif %}
                                    <div style="font-weight:700; font-size:14px; text-align:center; border-bottom:2px solid #1a1a1a; padding-bottom:4px; margin-bottom:6px;">{{ company.name|upper }}</div>
                                    <div style="margin-top:6px; line-height:1.35; text-align:center;">
                                        {{ company.address }}<br>
                                        {% if company.city %}{{ company.city }}{% if company.state %}, {{ company.state }}{% endif %}{% if company.pin_code %} - {{ company.pin_code }}{% endif %}<br>{% endif %}
                                        {% if company.phone %}<strong>Ph:</strong> {{ company.phone }}<br>{% endif %}
                                        {% if company.email %}<strong>Email:</strong> {{ company.email }}<br>{% endif %}
                                        {% if company.gst_number %}<strong>GSTIN:</strong> {{ company.gst_number }}<br>{% endif %}
                                    </div>
                                </div>
                            </td>
                            <!-- TOP RIGHT: meta table -->
                            <td id="block-2">
                                <div class="block-inner">
                                    <table class="meta-table" role="table">
                                        <tbody>
                                            {% block voucher_meta %}
                                            <tr><td class="label">Date:</td><td class="value">{{ voucher.date|format_date(format_str=org.date_format or '%d/%m/%Y') }}</td></tr>
                                            <tr><td class="label">Voucher No.:</td><td class="value">{{ voucher.voucher_number|default('N/A') }}</td></tr>
                                            {% if voucher.reference_number %}<tr><td class="label">Ref. No.:</td><td class="value">{{ voucher.reference_number }}</td></tr>{% endif %}
                                            {% endblock %}
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <!-- BOTTOM LEFT: Bill To -->
                            <td id="block-3">
                                <div class="block-inner">
                                    {% set party = voucher.vendor or voucher.customer %}
                                    {% if party %}
                                    <div style="font-weight:700; border-bottom:2px solid #1a1a1a; padding-bottom:3px; margin-bottom:5px;">{{ 'VENDOR DETAILS' if voucher.vendor else 'CUSTOMER DETAILS' }}</div>
                                    <div style="font-weight:700; margin-top:4px;">{{ party.name|upper }}</div>
                                    <div style="line-height:1.35; margin-top:3px;">{{ party.address }}{% if party.city %}, {{ party.city }}{% endif %}{% if party.state %}, {{ party.state }}{% endif %}{% if party.pin_code %} - {{ party.pin_code }}{% endif %}</div>
                                    {% if party.contact_number %}<div><strong>Contact:</strong> {{ party.contact_number }}</div>{% endif %}
                                    {% if party.gst_number %}<div><strong>GSTIN:</strong> {{ party.gst_number }}</div>{% endif %}
                                    {% else %}
                                    <div style="font-weight:700;">NO PARTY DETAILS</div>
                                    {% endif %}
                                </div>
                            </td>
                            <!-- BOTTOM RIGHT: Ship To -->
                            <td id="block-4">
                                <div class="block-inner">
                                    <div style="font-weight:700; border-bottom:2px solid #1a1a1a; padding-bottom:3px; margin-bottom:5px;">SHIP TO</div>
                                    {% if voucher.vendor %}
                                    <!-- For purchase vouchers, show company address as ship to -->
                                    <div style="font-weight:600;">{{ company.name|upper }}</div>
                                    <div>{{ company.address1 }}{% if company.address2 %}, {{ company.address2 }}{% endif %}</div>
                                    <div>{{ company.city }}{% if company.state %}, {{ company.state }}{% endif %}{% if company.pin_code %} - {{ company.pin_code }}{% endif %}</div>
                                    {% if company.contact_number %}<div>Contact: {{ company.contact_number }}</div>{% endif %}
                                    {% if company.gst_number %}<div>GSTIN/UIN: {{ company.gst_number }}</div>{% endif %}
                                    {% else %}
                                    <!-- For sales vouchers, show shipping address or customer -->
                                    {% if voucher.shipping_address %}
                                    <div style="font-weight:600;">{{ voucher.shipping_address.name|default('') }}</div>
                                    <div>{{ voucher.shipping_address.address }}</div>
                                    <div>{{ voucher.shipping_address.city }}{% if voucher.shipping_address.state %}, {{ voucher.shipping_address.state }}{% endif %}{% if voucher.shipping_address.pin_code %} - {{ voucher.shipping_address.pin_code }}{% endif %}</div>
                                    {% if voucher.shipping_address.contact %}<div>Contact: {{ voucher.shipping_address.contact }}</div>{% endif %}
                                    {% if voucher.shipping_address.email %}<div>Email: {{ voucher.shipping_address.email }}</div>{% endif %}
                                    {% if voucher.shipping_address.gst_number %}<div>GSTIN/UIN: {{ voucher.shipping_address.gst_number }}</div>{% endif %}
                                    {% if voucher.shipping_address.pan_number %}<div>PAN/IT No: {{ voucher.shipping_address.pan_number }}</div>{% endif %}
                                    {% else %}
                                    {% if party %}
                                    <div style="font-weight:600;">{{ party.name|upper }}</div>
                                    <div>{{ party.address }}{% if party.city %}, {{ party.city }}{% endif %}{% if party.state %}, {{ party.state }}{% endif %}{% if party.pin_code %} - {{ party.pin_code }}{% endif %}</div>
                                    {% if party.contact_number %}<div>Contact: {{ party.contact_number }}</div>{% endif %}
                                    {% if party.email %}<div>Email: {{ party.email }}</div>{% endif %}
                                    {% if party.gst_number %}<div>GSTIN/UIN: {{ party.gst_number }}</div>{% endif %}
                                    {% if party.pan_number %}<div>PAN/IT No: {{ party.pan_number }}</div>{% endif %}
                                    {% else %}
                                    <div style="font-weight:600;">(Same as Bill To)</div>
                                    {% endif %}
                                    {% endif %}
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                {% block after_blocks_grid %}{% endblock %}
                
                <!-- Items table -->
                <table class="items-table" role="table">
                    <thead>
                        <tr>
                            <th class="col-sr">Sr.</th>
                            <th class="col-product">Product Description</th>
                            <th class="col-hsn">HSN</th>
                            <th class="col-qty">Qty</th>
                            <th class="col-rate">Rate</th>
                            {% if line_discount_enabled %}<th class="col-disc">Disc</th>{% endif %}
                            <th class="col-gst">GST%</th>
                            <th class="col-line">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if items|length > 0 %}
                        {% for item in items %}
                        <tr>
                            <td class="col-sr">{{ loop.index }}</td>
                            <td class="col-product"><strong>{{ item.product_name|default(item.description, 'Product') }}</strong></td>
                            <td class="col-hsn">{{ item.hsn_code|default('-') }}</td>
                            <td class="col-qty num">{% if item.quantity > 0 %}{{ "%.2f"|format(item.quantity|float) }} {{ item.unit|default('Nos') }}{% else %}-{% endif %}</td>
                            <td class="col-rate num">{{ item.unit_price|format_currency(show_symbol=True) }}</td>
                            {% if line_discount_enabled %}
                            <td class="col-disc num">
                                {% if item.discount_percentage > 0 %}{{ item.discount_percentage }}%{% elif item.discount_amount > 0 %}{{ item.discount_amount|format_currency(show_symbol=True) }}{% else %}-{% endif %}
                            </td>
                            {% endif %}
                            <td class="col-gst num">{{ item.gst_rate|format_percentage }}%</td>
                            <td class="col-line num">{{ item.total_amount|format_currency(show_symbol=True) }}</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="{% if line_discount_enabled %}8{% else %}7{% endif %}" class="text-center" style="font-style:italic; color:#666;">No items available</td>
                        </tr>
                        {% endif %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td></td>
                            <td style="font-weight:700; text-align:right;">TOTALS:</td>
                            <td></td>
                            <td class="num" style="font-weight:700;">{{ total_quantity|default(0) }}</td>
                            <td></td>
                            {% if line_discount_enabled %}<td></td>{% endif %}
                            <td></td>
                            <td class="num" style="font-weight:700;">{{ subtotal|format_currency(show_symbol=True) }}</td>
                        </tr>
                    </tfoot>
                </table>
                
                <!-- Bank Details & Totals -->
                <table class="totals-bank" role="region">
                    <tr>
                        <td class="left-side">
                            {% block totals_left %}
                            <div style="font-weight:700; margin-bottom:8px; text-transform:uppercase; border-bottom:2px solid #1a1a1a; padding-bottom:4px;">Company's Bank Details</div>
                            {% if company.bank_details %}
                            <div style="line-height:1.45;">
                                <div><strong>Account Holder:</strong> {{ company.bank_details.holder_name|default(company.name) }}</div>
                                <div><strong>Account Number:</strong> {{ company.bank_details.account_number }}</div>
                                <div><strong>IFSC Code:</strong> {{ company.bank_details.ifsc }}</div>
                                <div><strong>Bank & Branch:</strong> {{ company.bank_details.bank_name }}, {{ company.bank_details.branch }}</div>
                            </div>
                            {% endif %}
                            {% if company.pan_number %}<div style="margin-top:8px; font-size:10px; font-weight:600;"><strong>PAN:</strong> {{ company.pan_number }}</div>{% endif %}
                            {% endblock %}
                        </td>
                        <td class="totals">
                            <table>
                                <tbody>
                                    <tr><td class="muted">Taxable Value:</td><td class="right num">{{ total_taxable|format_currency(show_symbol=True) }}</td></tr>
                                    {% if is_interstate %}
                                    <tr><td class="muted">IGST @ {{ voucher.gst_rate|default(18) }}%:</td><td class="right num">{{ total_igst|format_currency(show_symbol=True) }}</td></tr>
                                    {% else %}
                                    <tr><td class="muted">CGST @ {{ voucher.gst_rate|default(9) }}%:</td><td class="right num">{{ total_cgst|format_currency(show_symbol=True) }}</td></tr>
                                    <tr><td class="muted">SGST @ {{ voucher.gst_rate|default(9) }}%:</td><td class="right num">{{ total_sgst|format_currency(show_symbol=True) }}</td></tr>
                                    {% endif %}
                                    <tr><td class="muted">Round Off:</td><td class="right num">{{ round_off|format_currency(show_symbol=True) }}</td></tr>
                                    <tr style="border-top:3px double #1a1a1a;"><td style="font-weight:700; font-size:12px; text-transform:uppercase;">Grand Total:</td><td class="right num" style="font-weight:700; font-size:13px;">{{ grand_total|format_currency(show_symbol=True) }}</td></tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                </table>
                
                <!-- Amount in words -->
                {% block amount_words_block %}
                <div class="amount-words">
                    <div class="label">Total Amount (In Words):</div>
                    <div class="words">{{ amount_in_words }}</div>
                </div>
                {% endblock %}
                
                <!-- Terms & Conditions -->
                {% block terms_block %}
                {% if terms_conditions %}
                <div class="terms">
                    <div class="terms-title">Terms & Conditions</div>
                    <table>
                        <tbody>
                            {% for term in terms_conditions.split('\n') %}
                            {% if term|trim %}
                            <tr><td>{{ loop.index }}. {{ term|trim }}</td></tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
                {% endblock %}
                
                <!-- Signatures -->
                {% block signatures_block %}
                <div class="signatures">
                    <div>
                        <div style="font-weight:600; margin-bottom:8px;">Customer's Signature</div>
                        <div class="sig-line">_____________________</div>
                    </div>
                    <div>
                        <div style="font-weight:700; margin-bottom:8px;">For {{ company.name|upper }}</div>
                        <div class="sig-line">Authorized Signatory</div>
                    </div>
                </div>
                {% endblock %}
                
                {% block voucher_specific_footer %}{% endblock %}
            </div>
        </div>
    </div>
</body>
</html>